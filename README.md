# temporal-topo-flow
Time-dependent flow over topography. â³â›°ï¸ğŸŒŠ

This repository contains scripts for simulating time-variable flow over corrugated topography, using the shallow water model from [Oceananigans.jl](https://clima.github.io/OceananigansDocumentation/stable/).  

[Some info on the project]


## Project structure

```
temporal-topo-flow/
â”œâ”€ configs/                     # Experiment configs (JSON) for main runs
â”œâ”€ input/                       # Generated input files live here
â”œâ”€ notebooks/                   # Jupyter notebooks (postprocessing / plotting)
â”œâ”€ output/
â”‚  â”œâ”€ processed/                # Contains data needed for the figures in the paper 
â”œâ”€ reproduce_brink_2010/        # Validation: reproduce figures from Brink (2010)
â”‚  â”œâ”€ code/
â”‚  â”‚  â”œâ”€ brink_2010.jl          # Run SW model & save output
â”‚  â”‚  â”œâ”€ plot_brink_fig2.jl     # Recreate Fig. 2 from Brink (2010)
â”‚  â”‚  â””â”€ plot_brink_fig3.jl     # Recreate Fig. 3 from Brink (2010)
â”‚  â”œâ”€ figures/                  # Generated figures 
â”‚  â””â”€ output/                   # Example output
â”œâ”€ scripts/                     # scripts for experiments, including the simulation setup in "simulations.jl"
â”œâ”€ utils/                       # Helper functions
â”œâ”€ Project.toml                 # Julia project manifest (dependencies)
â””â”€ README.md
```


## Analysis presented in the paper
### Postprocessing

Postprocessing and analysis of simulations for the paper is done in  
`notebooks/postprocess_modeloutput.ipynb`.
Note that this requires that the simulation output is already created (see below). It is recomended to run the simulations on a using HPC resourses, idelay on GPUs. However, the resulted postprocessed data is already included in this repository under `output/processed/`.

### Plotting
Figures for the paper are created in
`notebooks/make_figures.ipynb`. This makes use of the alerady processed data in `output/processed/`.

## How to run the simulations

### Requirements
- **Julia** 
- **Packages:** managed via `Project.toml` (instantiated automatically)

### 1) Clone the repository
```bash
git clone  https://github.com/alpsjur/temporal-topo-flow.git
cd temporal-topo-flow
```

### 2) Instantiate the Julia environment
Run once to install all packages for this project:
```bash
julia --project=. -e 'using Pkg; Pkg.instantiate()'
```
If you prefer the REPL:
```julia
using Pkg
Pkg.activate(".")
Pkg.instantiate()
```

The `--project` flag makes Julia use this repoâ€™s environment. Packages are installed locally.

### 3) Optional: Generate forcing files
If spesified in the config file, experiments can be ran with forcing from file. These forcing files can be generated by scripts like `scripts/generate-crossslope-forcing`.

### 4) Run simulations
#### Single experiment

To run a single experiment with configuration spesified in `configs/experiment_name.json`:
```bash
julia --project=. scripts/simulation.jl configs/experiment_name.json
```

#### Batch run
To run multiple experiments conveniently, use the provided bash script:

```bash
./runs_simulations.bash
```

- This script loops through a set of configs in `configs/` and launches simulations.  
- Each run writes output into its own subfolder (by default under `output/raw/`).  
- You can edit the script to add/remove experiments, or adjust paths for your system.


## Topographic wave calculations
Topographic wave properties are calculated using the Matlab code [bwavesp](https://darchive.mblwhoilibrary.org/entities/publication/5433c043-2cc9-4906-a63e-c80a57f524e3). 

For this project, the code is ran using the script `script/run_bwavesp.m`, with input from the file `input/bwavesp_input.txt`.

## Running the Brink (2010) validation case

From the repo root:
```bash
# 1) Run the simulation (saves .jld2 in reproduce_brink_2010/output)
julia --project=. reproduce_brink_2010/code/brink_2010.jl

# 2) Recreate figures (writes to reproduce_brink_2010/figures)
julia --project=. reproduce_brink_2010/code/plot_brink_fig2.jl
julia --project=. reproduce_brink_2010/code/plot_brink_fig3.jl
```
The repo includes small example outputs so you can test the plotting scripts without a full rerun.
